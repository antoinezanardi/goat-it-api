name: 🚀 Deploy To Production Workflow

on:
  release:
    types: [created]

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  upload-and-merge-images:
    name: Build and publish Docker images 🐳
    uses: ./.github/workflows/docker-build-and-push.yml
    with:
      registry_image: ${{ vars.DOCKER_REGISTRY_IMAGE }}
      platforms: '["linux/amd64","linux/arm64"]'
      tags: '["${{ github.event.release.tag_name }}","latest"]'
      environment_name: 'Docker Image Production'
      environment_url: ${{ vars.DOCKER_HUB_PRODUCTION_IMAGE_URL }}
