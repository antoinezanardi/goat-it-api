name: ğŸ›¡ï¸ Protect main branch
on:
  pull_request:
    branches:
      - main

jobs:
  require-develop-source:
    name: Require PR from develop branch â›µ
    runs-on: ubuntu-latest
    timeout-minutes: 5
    permissions:
      pull-requests: write
      issues: write
    steps:
      - name: Comment and fail if PR source branch is not 'develop' âŒ
        if: ${{ github.event.pull_request.head.ref != 'develop' }}
        uses: actions/github-script@v8
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const headRef = context.payload.pull_request.head.ref
            const body = `ğŸš« Pull requests to main must come from 'develop', but this PR comes from '${headRef}'. Please retarget this PR to 'develop'.`

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body
            })

            throw new Error(body)
